---
title: "平行四連桿優化器"
slug: 平行四連桿優化器
date: 2019-11-01
categories:
- Project
tags:
- MATLAB
- Optimizer
- fminsearch
thumbnailImagePosition: left
thumbnailImage: //i.imgur.com/w7ncmd3.png
---

## 介紹
機器是由多件具有適當強度的剛體構件所組成，而能達成某種動作，以執
行某種任務的設備。各剛體構件至少應有兩處以樞軸方式與其相聯件連接，並
產生相互運動。此種構件，不論是否為桿條形，通稱為連桿（link）。由多個
連桿所組成之組合，稱為連桿裝置或連桿組（linkage）
在連桿組中，最常見也最有用的機構，就是四連桿機構（four-bar linkage），四連桿機構雖然好用，但在設計上會有許多必須克服的點:
1. 最長桿件之長度，一定要小於其餘三連桿件長度之總和，否則無法組成四連桿機構
![](https://i.imgur.com/XIcZmdg.png)
2. 死點問題，一曲柄連桿機構，如果以曲柄 2 為主動，則此機構可運轉；如果以搖桿 4 為主動，曲柄 2 為被動，當曲柄 2 與連桿 3 成一直線時，由連桿所傳達之推力或拉力，僅能傳達於曲柄的軸心，而無使曲柄繞其軸心迴轉之力，此時曲柄 2之位置稱為死點（dead point）
![](https://i.imgur.com/et75VXv.png)

## 目的
我希望此系統僅需輸入工作點以及四連桿起始位置，即可得到最優設計解。

### 四連桿公式推導：
為了實現這個目的，我必須先了解四連桿式如何運作的，以及如何將其在Matlab上模擬，因此我參考了這篇資料

![](https://i.imgur.com/nPyeRYM.png)


使用向量加法定理能夠列出下方方程式
$$ae^{j\theta_2}+be^{j\theta_3}+ce^{j\theta_4}+de^{j\theta_1}=0$$

並可以改寫成三小函數形式
$$a(cos\theta_2+jsine\theta_2)+b(cos\theta_3+jsine\theta_3)-c(cos\theta_4+jsine\theta_4)-d(cos\theta_1+jsine\theta_1)=0$$

$$假設 \theta_1 =0, 即四連桿平貼至地面上，能將上式改寫為$$
\begin{aligned}		
	Asume :\ \ \ \ &\theta_1=0,\\
    so:  \ \ \ \ &acos\theta_2+bcos\theta_3-ccos\theta_4+d=0\\ 
     \ \ \ \ &asin\theta_2+bsin\theta_3-csin\theta_4=0 \\
	Rewite \ as :\ \ \ \ &bcos\theta_3=acos\theta_2+ccos\theta_4+d=0 \\
&bsin\theta_3=asin\theta_2+csin\theta_4=0 \\
\end{aligned}

將兩式相乘後整理得
$$ b^2=a^2+c^2-2adcos\theta_2+2cscos_4-2ac(sin\theta_2sin\theta_4+cos\theta_2cos\theta_4)$$

為了簡化方程式，定義K1, K2, K3 分別為:

$$K_1={d\over a}, \ \ \ \ K_2={d\over c}, \ \ \ \ K_3={a^2-b^2+c^2+d^2\over 2ac}$$
而得到
$$K_1cos\theta_4-K_2cos\theta_2+K_3=cos(\theta_2-\theta_4)$$

通過三角函數轉換後得
$$Atan^2({\theta_4\over 2})+Btan({\theta_4\over 2})+C=0$$
其中
\begin{aligned}
A&=cos\theta_2-K_1-K_2cos\theta_2+K_3 \\
B&=-2sin\theta_2 \\
C&=K_1-(K_2+1)cos\theta_2+K_3 \\
\end{aligned}
最後得到其中一組重要公式
$${\theta_4}_{1, 2}=2arctan({-B\pm \sqrt{B^2-4AC}\over 2A})$$

將以下式子相加後獲得
\begin{aligned}		&bcos\theta_3=acos\theta_2+ccos\theta_4+d=0 \\
&bsin\theta_3=asin\theta_2+csin\theta_4=0 \\
\Rightarrow \\
&ccos\theta_4=acos\theta_2+bcos\theta_3-d=0 \\
&csin\theta_3=asin\theta_2+bsin\theta_3=0 \\
\end{aligned}

經過與先前相同的推倒過程後可得到
$$Dtan^2({\theta_3\over 2})+Etan({\theta_3\over 2})+F=0$$
其中
\begin{aligned}
D&=cos\theta_2-K_1-K_4cos\theta_2+K_5 \\
E&=-2sin\theta_2 \\
F&=K_1-(K_4+1)cos\theta_2+K_5 \\
K_4&={d\over b} \\
K_5&={c^2-d^2-a^2-b^2 \over 2ab}
\end{aligned}

得到另一組一組重要公式
$${\theta_3}_{1, 2}=2arctan({-E\pm \sqrt{E^2-4DF}\over 2D})$$

得到這兩組公式後就對四連桿系統進行最佳化設計了!!!

### 最佳化程式設計 
在得到四連桿機構運動公式後，透過MATLAB撰寫程式，顯示四連桿系統的運動軌跡，在此我設定三角形之下兩點為四連桿的a1,b1點p1為三角形之頂點，並且設定希望四連桿運動經過的9個節點。
![](https://i.imgur.com/4zcm2XM.png)







 

設計步驟3：
為了找尋設計的最佳解，我使用Matlab裡的fminsearch進行搜尋，我設定變數為a1x, a1y, b1x, b1y,與 9個θ2共13個輸入變數，一開始輸入的a1x, a1y, b1x, b1y以及P1座標將決定三角形的形狀，而誤差值即為每次旋轉後三角形頂點與已知工作點座標的誤差，而為了避免四連桿之長度超過設定大小(>0.7,<5)，我設計當迭代後長度超過次範圍，error將會乘2予以懲罰，使梯度上升

![](https://i.imgur.com/FEFKYFh.png)


另外，因fminsearch無法找尋其他區域min值，我為了避開此缺點，設計尋找的min error方法是用±10的座標平面中的隨機x,y座標輸入fminsearch ，尋找500次，且將每一次fminsearch的結果迭代25次，最後找尋其最小誤差，望求得最佳設計解。
![](https://i.imgur.com/0Hi0LrA.png)


### 影片展示:
{{< youtube OY_ZJRH2OYw >}}

## 參考資料
https://scholar.cu.edu.eg/?q=anis/files/week04-mdp206-position_analysis-draft.pdf
http://www.pmai.tn.edu.tw/df_ufiles/df_pics/32710%E7%AC%AC14%E7%AB%A0.pdf

